function Trip(a,b){var c=this;this.raw=a,this.index=b,this.direction=a.direction,this.trip_id="#trip_"+a.id,this.route=drawRoute(this),base_height&&(base_height+=$(this.trip_id).height(),this.scroll_height=base_height),$(c.trip_id).mouseover(function(){c.highlight()}),c.direct()}function drawRoute(a){var b=a.raw,c=makeColor(Math.floor(b.direction*510)+1020),d=new google.maps.Polyline({map:map,strokeColor:c,strokeOpacity:.5,strokeWeight:4,path:b.route.map(function(a){return new google.maps.LatLng(a[0],a[1])})});return new google.maps.event.addListener(d,"mouseover",function(){a.highlight(),$("#trips_container").stop().animate({scrollTop:a.scroll_height},400)}),new google.maps.event.addListener(d,"click",function(a){infoWindow.setContent('<div class="place_form"><h2><a href="/trips/'+b.id+'">'+b.id+"</a></h2><p>"+b.bearing+"</div>"),infoWindow.setPosition(a.latLng),infoWindow.open(map)}),bounds.extend(new google.maps.LatLng(b.route[b.route.length-1][0],b.route[b.route.length-1][1])),bounds.extend(new google.maps.LatLng(b.route[0][0],b.route[0][1])),d}function set_heights(){var a=window.innerHeight-$("header").outerHeight()-$("footer").outerHeight()-$("form").height()-10;a=Math.max(a,parseInt($("#content").css("min-height"))),$("#map_canvas").css("height",a+"px"),$("#map_canvas").css("width",window.innerWidth+"px")}var map,infoWindow=new google.maps.InfoWindow,bounds=new google.maps.LatLngBounds,base_height,current,objects={starting:[],ending:[],passing_through:[]};$(function(){if(trips.length>0){map=new google.maps.Map(document.getElementById("map_canvas"),{center:new google.maps.LatLng(trips[0].route[0][0],trips[0].route[0][1]),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0}),base_height=-1*$("#trips_container").height()/2;for(var a=0;a<trips.length;a++)new Trip(trips[a],a);map.fitBounds(bounds)}["starting","ending","passing_through"].forEach(function(a){$("#"+a).click(function(){$(this).prop("checked")?objects[a].forEach(function(a){a.show()}):objects[a].forEach(function(a){a.hide()})}),objects[a].length===0&&($("#"+a).prop("disabled",!0),$("#"+a).prev().css("opacity",.3))})}),Trip.prototype.direct=function(){this.direction<.15?objects.ending.push(this):this.direction>.85?objects.starting.push(this):objects.passing_through.push(this)},Trip.prototype.highlight=function(){current?current.cancel():!1,$(this.trip_id).addClass("current_item"),this.route.setOptions({strokeWeight:6,strokeOpacity:1,zIndex:trips.length}),current=this},Trip.prototype.cancel=function(){$(this.trip_id).removeClass("current_item"),this.route.setOptions({strokeWeight:4,strokeOpacity:.5,zIndex:this.index})},Trip.prototype.hide=function(){$(this.trip_id).css("opacity",.15),this.route.setMap(null)},Trip.prototype.show=function(){$(this.trip_id).css("opacity",1),this.route.setMap(map)}