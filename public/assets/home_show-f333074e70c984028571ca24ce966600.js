/**
 * A distance widget that will display a circle that can be resized and will
 * provide the radius in km.
 *
 * @param {google.maps.Map} map The map to attach to.
 *
 * @constructor
 */
function DistanceWidget(a,b){this.set("map",a),this.set("position",a.getCenter());var c=new google.maps.Marker({draggable:!0,title:"Move me!"});this.set("marker",c),c.bindTo("map",this),c.bindTo("position",this);var d=new RadiusWidget(b);this.set("radiusWidget",d),d.bindTo("map",this),d.bindTo("center",this,"position"),this.bindTo("distance",d),this.bindTo("bounds",d),this.set("sizer",d.radius_marker)}function RadiusWidget(a){var b=new google.maps.Circle({strokeWeight:2});a.radius=1/KM_2_MI(1)*a.radius||40.2336,this.set("distance",parseFloat(a.radius)),this.bindTo("bounds",b),b.bindTo("center",this),b.bindTo("map",this),b.bindTo("radius",this),this.addSizer_()}function map_for(a,b){var c=new google.maps.Map(document.getElementById(a),{center:new google.maps.LatLng(37.790234970864,-122.39031314844),zoom:8,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP}),d=search[info[b].split("#")[1]+"_radius"],e=new DistanceWidget(c,{radius:d});google.maps.event.addListener(e.sizer,"drag",function(){continuous_radius_info(e,info[b])}),google.maps.event.addListener(e.sizer,"dragend",function(){radius_info(e,info[b])}),google.maps.event.addListener(e.marker,"dragend",function(){codeLatLng(e.marker,info[b])}),widgets.push(e),initialize(b)}function KM_2_MI(a){return a*.621371192}function continuous_radius_info(a,b){var c=a.get("distance");$(b+"_info .radius").html(KM_2_MI(c).toFixed(2)+"mi ("+c.toFixed(2)+"km)")}function radius_info(a,b){var c=a.get("distance");$(b+"_radius").val(KM_2_MI(c)),$(b+"_info .radius").html(KM_2_MI(c).toFixed(2)+"mi ("+c.toFixed(2)+"km)")}function initialize(a){var b=info[a].split("#")[1];$("#geocode_"+b).click(function(){var b=$(this).prev().val().replace(/^ +/g,"").replace(/ +$/g,"");b.length>0&&codeAddress(b,widgets[a],info[a]),show_map(a)}),search[b]&&codeAddress(search[b],widgets[a],info[a]),radius_info(widgets[a],info[a])}function codeAddress(a,b,c){var d=new google.maps.Geocoder;d.geocode({address:a},function(a,d){geo_results=a;if(d==google.maps.GeocoderStatus.OK){if(a[0]){var e=a[0].geometry.location;b.set("position",e),b.map.setCenter(e),$(c).val(a[0].formatted_address),$(c+"_coords").val(JSON.stringify([b.marker.getPosition().lat(),b.marker.getPosition().lng()]))}}else console.log("Geocoder failed due to: "+d)})}function codeLatLng(a,b){$(b+"_coords").val(JSON.stringify([a.getPosition().lat(),a.getPosition().lng()]));var c=new google.maps.Geocoder;c.geocode({latLng:a.getPosition()},function(a,c){geo_results=a;var d=0,e=4;if(c==google.maps.GeocoderStatus.OK){a.forEach(function(a,b){JSON.stringify(a.types)=='["locality","political"]'&&e>1?(e=1,d=b,console.log("local, political")):JSON.stringify(a.types)=='["neighborhood","political"]'&&e>2?(e=2,d=b,console.log("neighbord, political")):JSON.stringify(a.types)=='["postal_code"]'&&e>3&&(e=3,d=b)});var f=a[d].formatted_address;$(b).val(f)}else alert("Geocoder failed due to: "+c)})}function switching(){switch(JSON.stringify(r.types)){case'["locality","political"]':best=i;break;case'["neighborhood","political"]':best=i;break;case'["postal_code"]':best=i}}function show_map(a){switch(a){case 0:$("#origin_info").show(),google.maps.event.trigger(widgets[0].map,"resize"),widgets[0].map.setCenter(widgets[0].get("position")),widgets[0].map.fitBounds(widgets[0].radiusWidget.get("bounds"));break;case 1:$("#destination_info").show(),google.maps.event.trigger(widgets[1].map,"resize"),widgets[1].map.setCenter(widgets[1].get("position")),widgets[1].map.fitBounds(widgets[1].radiusWidget.get("bounds"))}}DistanceWidget.prototype=new google.maps.MVCObject,RadiusWidget.prototype=new google.maps.MVCObject,RadiusWidget.prototype.distance_changed=function(){this.set("radius",this.get("distance")*1e3)},RadiusWidget.prototype.addSizer_=function(){var a=new google.maps.Marker({draggable:!0,title:"Drag me!"});this.set("radius_marker",a),a.bindTo("map",this),a.bindTo("position",this,"sizer_position");var b=this;google.maps.event.addListener(a,"drag",function(){b.setDistance()})},RadiusWidget.prototype.center_changed=function(){var a=this.get("bounds");if(a){var b=a.getNorthEast().lng(),c=new google.maps.LatLng(this.get("center").lat(),b);this.set("sizer_position",c)}},RadiusWidget.prototype.distanceBetweenPoints_=function(a,b){if(!a||!b)return 0;var c=6371,d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h},RadiusWidget.prototype.setDistance=function(){var a=this.get("sizer_position"),b=this.get("center"),c=this.distanceBetweenPoints_(b,a);this.set("distance",c)};var widgets=[],geo_results,info=["#origin","#destination"];$(function(){map_for("map_for_origin",0),map_for("map_for_destination",1),$(".hide_map").click(function(){$(this).parent().hide()}),handle_datepicker(),toggle_favorite()})